# image store api

## 環境構築

### CDKデプロイ

```
$ npm run dep-env1-dev-all
```

---

### Google設定

`OAuth 2.0 クライアント ID`の構成が必要。手順については省略。

---

### API

* POST /token
    * Request
        ```json
        {
            "code": "authorization code generated by Google"
        }
        ```
    * Response:
        ```json
        {
            "idToken": "id_token generated by Google"
        }
        ```

* POST /presigned
    * Request
        * Authorization: `id_token`
        * Body:
            ```json
            {
                "name": "name of file, you can specify the path like: `dir/file.png`"
            }
            ```
    * Response
        ```json
        {
            "url": "the presigned url for uploading file to S3"
        }
        ```
    * How to use the presigned url
        ```
        $ url={url you got}
        $ curl -X PUT --upload-file {the local path of the file you want to upload} $url
        ```

* POST /image
    * Request
        * Authorization: `id_token`
        * Body:
            ```json
            {
                "objectKey": "object key of the file you uploaded, e.g. dir/file.png."
            }
            ```
    * Response
        ```json
        {
            "url": "signed url for accessing the file on S3"
        }
        ```

---
